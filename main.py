import os

from ioutil import Utils
from submit import BondChain

if __name__ == "__main__":
    # decide paths and convert data to json
    src_text = Utils.input_with_default('plain-text', 'test/1.txt')  # generated by Tencent QQ
    dst_json = Utils.input_with_default('converted Json', 'test/1.json', False)
    if not os.path.exists(dst_json) or Utils.input_yes_or_no('Json already exists, still exec convertion?'):
        # create or overwrite
        Utils.convert_txt_to_json(src_text, dst_json)
    else:
        print(f'Skipped convertion. Use existing Json [{dst_json}] instead')
    # initialize
    bc = BondChain()
    # login
    bc.login()
    # load data from json
    data = Utils.load(dst_json)
    # traverse data and submit them
    failed = bc.add_offers(data)
    # print failed offers
    if failed: print(f'\n* Totally {len(failed)} fail(s):')
    for fail in failed:
        print(fail)
    # end
    input('\nPress any key to continue...')
