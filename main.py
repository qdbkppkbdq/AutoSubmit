import os

from jsonio import JsonUtil
from submit import BondChain


def input_with_default(file_descr: str, default_path: str, require_exists: bool = True) -> str:
    while True:
        val = input(f'Path to {file_descr} file: ')
        if not val: break
        if not require_exists or os.path.isfile(val): break
        print(f' * Given path [{val}] does not exist or cannot access, please try again')
    if not val:
        print(f' * Fall back to default path [{default_path}]')
        return default_path
    print(f' * Using [{val}] as path of {file_descr} file')
    return val


if __name__ == "__main__":
    # convert data to json# generated by Tencent QQ
    src_text = input_with_default('plain-text', 'test/1.txt')
    dst_json = input_with_default('converted', 'test/1.json', False)
    JsonUtil.convert_txt_to_json(src_text, dst_json)
    # initialize
    bc = BondChain()
    # login
    bc.login()
    # load data
    data = JsonUtil.load(dst_json)
    # traverse data and submit them
    failed = bc.add_offers(data)
    # print failed offers
    if failed: print(f'\n* Totally {len(failed)} fail(s):')
    for fail in failed:
        print(fail)
    # end
    input('\nPress any key to continue...')
